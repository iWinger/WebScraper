import smtplib, ssl
from bs4 import BeautifulSoup
import requests
import base64
import time
import re
from scraper.price import content


def comparePrice(url, companyName):
    item_list, image_list, price_list = content(url)

    if (item_list):
        company_list = []
        for i in range(len(item_list)):
            if companyName in item_list[i]:
                company_list.append(item_list[i])
        # print(company_list)
        price = ''
        if (len(price_list[0]) > 7):
            comma = price_list[0].find(',')
            price = str(price_list[0][1:comma] + price_list[0][comma + 1:])

        minPrice = float(price)
        index = 0
        changed = False

        if (item_list[0] in company_list):
            changed = True
        for i in range(len(price_list)):
            price = ''
            newPrice = 0
            if (len(price_list[i]) > 7):
                comma = price_list[i].find(',')
                price = str(price_list[i][1:comma] + price_list[i][comma + 1:])
            if (price == ''):
                newPrice = float(price_list[i][1:])
            else:
                newPrice = float(price)

            if (newPrice < minPrice and (item_list[i] in company_list)):
                minPrice = newPrice
                index = i
                changed = True

        if (changed):
            return item_list[index], image_list[index], price_list[index]
        else:
            print("ERROR: Company not found")
            return None, None, None
    else:
        print("ERROR: No entries found in url")
        return None, None, None
